@model System.Data.Entity.Core.Objects.ObjectResult<GetStatisticaMagazineDupaCantitati_Result>

@{
    ViewBag.Title = "StatisticaMagazineDupaCantitati_Grafic";
    Layout = "~/Views/Shared/_Layout.cshtml";

}
<br/>

<div class="row">
    <div class="col m5 input-field">
        <input type="text" class="datepicker" id ="startDate">
        <label for="startDate">Data inceput</label>
    </div>
    <div class="col m5 input-field">
        <input type="text" class="datepicker" id="endDate">
        <label for="endDate">Data final</label>
    </div>
    <div class="col m2">
        <a href="#" class="btn btn-small waves-effect" id="getData">Genereaza raport</a> 
    </div>
</div>

<div class="row">
    <div id="statistica-grafic"></div>
</div>


@section Scripts{
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
        var model = @Html.Raw(Json.Encode(this.Model));
        function createDataTable(items) {
            var result = [];
            result.push(['Magazin', 'Total Cantitate Vanduta']);
            for (var i = 0; i < items.length; ++i) {
                var nume = items[i]["Denumire"] + " " + items[i]["Oras"];
                result.push([nume, items[i]["CantitateTotala"]]);
            }

            return result;
        }
        
        var dataTable = createDataTable(model);
        google.charts.load('current', { packages: ['corechart', 'bar']});
        google.charts.setOnLoadCallback(drawTitleSubtitle);


        function drawTitleSubtitle() {
            var data = google.visualization.arrayToDataTable(dataTable);

            var options = {
                chart: {
                    title: 'Statistica vanzari magazine un functie de cantitati'
                },
                hAxis: {
                    format: 'decimal'
                },
                bars: 'horizontal'
            };
            var materialChart = new google.charts.Bar(document.getElementById('statistica-grafic'));
            materialChart.draw(data, google.charts.Bar.convertOptions(options));
        }

        $('#getData').click(function() {
            var startDate = $('#startDate').val();
            var endDate = $('#endDate').val();

            $.ajax({
                url: '@Url.Action("GetStatisticaMagazineDupaCantitati_Data")',
                type: 'GET',
                data: {startDate: startDate, endDate: endDate},
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                error: function (xhr) {
                    alert('Error: ' + xhr.statusText);
                },
                success: function (result) {
                    dataTable = createDataTable(result);
                    google.charts.setOnLoadCallback(drawTitleSubtitle);
                },
                async: true
            });

        });
    </script>
}